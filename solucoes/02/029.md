## Pergunta

29 - O ficheiro [`029.tsv`](../../problemas/02/029.tsv) contém dados, separados por _tabs_,
sobre todos os exoplanetas conhecidos (a 30-11-2018). Cada linha contém a
seguinte informação:

* ID do planeta
* Nome do sistema estelar a que o planeta pertence
* Letra do planeta dentro do seu sistema estelar
* Nome do planeta
* Método de deteção do planeta
* Período orbital em dias
* Distância em _parsecs_
* Temperatura em Kelvins
* Telescópio responsável pela descoberta

As linhas que começam com o carácter `#` são comentários e devem ser ignoradas.

Cria um projeto no Visual Studio que respeite os seguintes requisitos:

1. Enumeração que contenha os diferentes métodos de descoberta de exoplanetas.
2. _Struct_ imutável `Planet`, que contém toda a informação sobre um planeta
   sob a forma de propriedades só de leitura e um construtor para inicializar
   essas mesmas propriedades. Cada propriedade deve ser do tipo apropriado ao
   dado que reporta.
3. A _struct_ `Planet` deve ter _overrides_ de `GetHashCode()` e `Equals()` de
   modo a que a igualdade entre planetas dependa apenas do respetivo ID.
4. Classe `PlanetLoader`, com um único método `LoadPlanets()`. Este método
   aceita um parâmetro o nome de ficheiro que contém os dados sobre os
   planetas, devolvendo um `IEnumerable<Planet>` com todos os planetas lidos.
   Tanto a classe como o método devem ser `static`.
5. Classe `Program`, com método `Main()`, no qual é invocado o método
   `LoadPlanets()`, e posteriormente mostrada no ecrã a seguinte informação,
   obtida com o uso de Lambdas e LINQ (sintaxe fluente ou expressões _query_,
   sem preferência):
   * Número de exoplanetas existentes.
   * Método mais comum de deteção.
   * Máximo de exoplanetas em torno da mesma estrela.
   * Média do período orbital.
   * Planeta mais longínquo (e a respetiva distância).
   * Média da temperatura dos planetas cuja estrela tem pelo menos dois
     planetas.
   * Telescópio com menos descobertas.
6. Todas as possíveis exceções devem ser tratadas ao nível da classe
   `Program`.
7. Todas as classes e respetivos membros devem estar documentados com
   comentários XML.

## Soluções

### Solução 1

Enum `DiscoveryMethod`:

```cs
enum DiscoveryMethod
{
    Astrometry,
    DiskKinematics,
    EclipseTimingVariations,
    Imaging,
    Microlensing,
    OrbitalBrightnessModulation,
    PulsarTiming,
    PulsationTimingVariations,
    RadialVelocity,
    Transit,
    TransitTimingVariations
}

```Classe `Planet`:

```cs
struct Planet
{
    public int PlanetID { get; }
    public string HostSystemName { get; }
    public char PlanetLetter { get; }
    public string PlanetName { get; }
    public DiscoveryMethod DiscoveryMethod { get; }
    public float OrbitPeriodDays { get; }
    public float ParsecsDistance { get; }
    public float TempInKelvins { get; }
    public string DiscoveryFacility { get; }

    public Planet(int plntID, string hstSysName, char plntLtr,
        string plntName, DiscoveryMethod discMethd, float orbtPrd,
        float ParsDist, float tempKlvn, string discFclt)
    {
        PlanetID = plntID;
        HostSystemName = hstSysName;
        PlanetLetter = plntLtr;
        PlanetName = plntName;
        DiscoveryMethod = discMethd;
        OrbitPeriodDays = orbtPrd;
        ParsecsDistance = ParsDist;
        TempInKelvins = tempKlvn;
        DiscoveryFacility = discFclt;
    }

    public override int GetHashCode() => PlanetID;

    public override bool Equals(object other)
    {
        if (other == null) return false;
        if (GetHashCode() == other.GetHashCode()) return true;
        else return false;
    }

    public override string ToString() =>
        $"Planet ID: {PlanetID}, Host System: {HostSystemName}, " +
        $"Planet Letter: {PlanetLetter}, Planet Name: {PlanetName}, " +
        $"Discovery Method:: {DiscoveryMethod}, " +
        $"Orbit Period: {OrbitPeriodDays:f8} days, " +
        $"Distance in Parsecs: {ParsecsDistance:f2}, " +
        $"Temperature in Kelvins: {TempInKelvins:f2}, " +
        $"Discovery Facility: {DiscoveryFacility}";
}
```

Class `PlanetLoader`:

```cs
static class PlanetLoader
{
    public static IEnumerable<Planet> LoadPlanets(string ficheiro)
    {
        // Define local variables
        string line;
        string[] elements;
        string[] discMtdParseArray;
        Planet returnPlanet;
        List<string> strLst = new List<string>();

        using (FileStream fs = new FileStream(ficheiro, FileMode.Open))
        {
            using(StreamReader sr = new StreamReader(fs))
            {
                while ((line = sr.ReadLine()) != null)
                {
                    strLst.Clear();
                    if (line[0] != '#' && Int32.TryParse($"{line[0]}",
                        out int firstChar))
                    {
                        elements = line.Split("\t");

                        foreach (string s in elements) strLst.Add(s);

                        // TryParse ID into it's own variable
                        int.TryParse($"{elements[0]}", out int id);
                        // TryParse PlanetLetter into it's own variable
                        char.TryParse(strLst[2], out char plntLtr);
                        // Split Discovery Method string, join
                        // into a single string and TryParse into it's
                        // own variable
                        discMtdParseArray = strLst[4].Split(" ");
                        string tempString = "";
                        foreach(string strArr in discMtdParseArray)
                        {
                            tempString += strArr;
                        }
                        strLst[4] = tempString;
                        if (!Enum.TryParse(strLst[4],
                            out DiscoveryMethod dscMt))
                            Console.WriteLine($"Carallo, dis no work!" +
                                $" ID: {id}");
                        // TryParse OrbitalPeriod into it's own variable
                        float.TryParse(strLst[5], out float orbtPrd);
                        // TryParse ParsecDistance into it's own variable
                        float.TryParse(strLst[6], out float parsDist);
                        // TryParse TempInKelvins into it's own variable
                        float.TryParse(strLst[7], out float tmpInKlv);

                        returnPlanet = new Planet(
                            id,
                            strLst[1],
                            plntLtr,
                            strLst[3],
                            dscMt,
                            orbtPrd,
                            parsDist,
                            tmpInKlv,
                            strLst[8]);

                        yield return returnPlanet;
                    }
                }
            }
        }
    }
}
```

Classe `Program`:

```cs
using System;
using System.Collections.Generic;
using System.Linq;
using System.IO;

class Program
{
    static void Main(string[] args)
    {
        string ficheiro = Path.Combine(Environment.GetFolderPath(
               Environment.SpecialFolder.UserProfile),
               @"source\repos\lp2_exercicios\problemas\02\029.tsv");
        IEnumerable<Planet> planetEnumerable;

        planetEnumerable = PlanetLoader.LoadPlanets(ficheiro);

        int numberOfPlanets =
            (from plnt in planetEnumerable
             select plnt
             ).Count();

        DiscoveryMethod prevalentDiscMethod =
            (from plnt in planetEnumerable
             group plnt by plnt.DiscoveryMethod into plntGrp
             orderby plntGrp.Count() descending
             select plntGrp.Key
             ).First();

        int maxExoplanetsInSingleSystem =
            ((from plnt in planetEnumerable
              group plnt by plnt.HostSystemName into plntNameGrp
              orderby plntNameGrp.Count() descending
              select plntNameGrp).First()
             ).Count();

        float averageOrbitalPeriod =
            (from plnt in planetEnumerable
             select plnt.OrbitPeriodDays
             ).Average();

        Planet furthestPlanet =
            (from plnt in planetEnumerable
             orderby plnt.ParsecsDistance descending
             select plnt
             ).First();

        float avgTempInTwoPlusPlanetSys =
            (from plnt in planetEnumerable
             where plnt.HostSystemName.Count() >= 2
             group plnt by plnt.TempInKelvins into plntTempGrp
             select plntTempGrp.Key
            ).Average();

        string facilityWithLeastDiscoveries =
            (from plnt in planetEnumerable
             group plnt by plnt.DiscoveryFacility into plntDiscFclt
             orderby plntDiscFclt.Count() ascending
             select plntDiscFclt.Key
             ).First();

        Console.WriteLine($"Number of Planets: {numberOfPlanets}");
        Console.WriteLine($"Prevalent Discovery Method: " +
            $"{prevalentDiscMethod}");
        Console.WriteLine($"Maximum Number of Exoplanets in a single " +
            $"System: {maxExoplanetsInSingleSystem}");
        Console.WriteLine($"Average Orbital Period: " +
            $"{averageOrbitalPeriod} days");
        Console.WriteLine($"Furthest Exoplanet is " +
            $"{furthestPlanet.PlanetName}, which is " +
            $"{furthestPlanet.ParsecsDistance:f2} Parsecs away");
        Console.WriteLine($"Average Temperature of Exoplanets in " +
            $"systems with two or more Exoplanets: " +
            $"{avgTempInTwoPlusPlanetSys}");
        Console.WriteLine($"Facility with the least Discoveries: " +
            $"{facilityWithLeastDiscoveries}");
    }
}
```

**Nota:** Código de teste para este exercício encontra-se neste
[repositório](https://github.com/PmaiWoW/LP2_Github_Exercises).

*Por [Pedro Inácio](https://github.com/PmaiWoW).*